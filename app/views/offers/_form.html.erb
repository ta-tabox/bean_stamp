<div class="form-container">
  <div class="form">
    <%= form_with(model: @offer) do |f| %>
      <%= render "shared/error_messages", resource: f.object %>
      <h1 class="text-center"><%= yield(:form_title) %></h1>
      <%= f.hidden_field :bean_id, value: "#{@bean.id}" %>
      <div class="field">
        <%= f.label :ended_at, class: "label" %>
        <%= f.date_field :ended_at, autofocus: true, min: Date.today, max: Date.today.next_month(1), class: "input-field" %>
      </div>
      <div class="field">
        <%= f.label :roasted_at, class: "label" %>
        <%= f.date_field :roasted_at, min: Date.today, max: Date.today.next_month(1), class: "input-field" %>
      </div>
      <div class="field">
        <%= f.label :receipt_started_at, class: "label" %>
        <%= f.date_field :receipt_started_at, min: Date.today, max: Date.today.next_month(1), class: "input-field" %>
      </div>
      <div class="field">
        <%= f.label :receipt_ended_at, class: "label" %>
        <%= f.date_field :receipt_ended_at, min: Date.today, max: Date.today.next_month(2), class: "input-field" %>
      </div>
      <div class="field">
        <%= f.label :price, class: "label" %>
        <%= f.number_field :price, placeholder: "販売価格（円）", min: 0, class: "input-field" %>
      </div>
      <div class="field">
        <%= f.label :weight, class: "label" %>
        <%= f.number_field :weight, placeholder: "内容量（g）", min: 50, step: 50, class: "input-field" %>
      </div>
      <div class="field">
        <%= f.label :amount, class: "label" %>
        <%= f.number_field :amount, placeholder: "数量（個）", min: 1, class: "input-field" %>
      </div>
      <div class="flex">
        <%= link_to "一覧に戻る", beans_path , class: "mr-4 btn-primary", data: { confirm: '入力中のデータは削除されます。キャンセルしますか？'} %>
        <div class="actions">
          <%= f.submit yield(:button_text), class: "btn-primary" %>
        </div>
      </div>
      <div>
        <% if @offer.id? %>
          <p>オファーを
            <%= link_to '削除する', offer_path(@offer), data: { confirm: "本当に削除しますか？"}, method: :delete , class: "link mt-4"%>
          </p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
<script>
  // オファー終了日の検証
  document.getElementById("offer_ended_at").onchange = function() {
    const endedAt = document.getElementById("offer_ended_at");
    const roastedAt = document.getElementById("offer_roasted_at");
    const dateEndedAt = new Date(endedAt.value);
    const dateRoastedAt = new Date(roastedAt.value);

    if (dateRoastedAt <= dateEndedAt) {
      alert('オファー終了日は焙煎日より前を設定してください');
      endedAt.value = null;
    }
  };

  //焙煎日の検証
  document.getElementById("offer_roasted_at").onchange = function() {

    const endedAt = document.getElementById("offer_ended_at");
    const roastedAt = document.getElementById("offer_roasted_at");
    const receiptStartedAt = document.getElementById("offer_receipt_started_at");
    const dateEndedAt = new Date(endedAt.value);
    const dateRoastedAt = new Date(roastedAt.value);
    const dateReceiptStartedAt = new Date(receiptStartedAt.value);

    if (dateRoastedAt <= dateEndedAt) {
      alert('焙煎日はオファー終了日より後を設定してください');
      roastedAt.value = null;
      }
    else if ( dateReceiptStartedAt <= dateRoastedAt) {
      alert('焙煎日は受け取り開始日より前を設定してください');
      roastedAt.value = null;
      }
  };

  //受け取り開始日の検証
  document.getElementById("offer_receipt_started_at").onchange = function() {
    const roastedAt = document.getElementById("offer_roasted_at");
    const receiptStartedAt = document.getElementById("offer_receipt_started_at");
    const receiptEndedAt = document.getElementById("offer_receipt_ended_at");
    const dateRoastedAt = new Date(roastedAt.value);
    const dateReceiptStartedAt = new Date(receiptStartedAt.value);
    const dateReceiptEndedAt = new Date(receiptEndedAt.value);

    if (dateReceiptStartedAt <= dateRoastedAt) {
      alert('受け取り開始日は焙煎日より後を設定してください');
      receiptStartedAt.value = null;
      }
    else if ( dateReceiptEndedAt <= dateReceiptStartedAt) {
      alert('受け取り開始日は受け取り終了日より前を設定してください');
      receiptStartedAt.value = null;
      }
  };

  //受け取り終了日の検証
  document.getElementById("offer_receipt_ended_at").onchange = function() {
    const receiptStartedAt = document.getElementById("offer_receipt_started_at");
    const receiptEndedAt = document.getElementById("offer_receipt_ended_at");
    const dateReceiptStartedAt = new Date(receiptStartedAt.value);
    const dateReceiptEndedAt = new Date(receiptEndedAt.value);

    if (dateReceiptEndedAt <= dateReceiptStartedAt) {
      alert('受け取り終了日は受け取り開始日より後を設定してください');
      receiptEndedAt.value = null;
      }
  };
</script>
